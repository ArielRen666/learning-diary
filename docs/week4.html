<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ariel‚Äôs RS learning diary - 4&nbsp; Week 4 - Air Pollution &amp; Control Action in Beijing</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week5.html" rel="next">
<link href="./week3.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week4.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - Air Pollution &amp; Control Action in Beijing</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Ariel‚Äôs RS learning diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Personal Introductionüòä</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week 1 - Introduction to Remote Sensing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 2 - Presentation of Sentinel-1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 - Corrections and Image Enhancements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week4.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - Air Pollution &amp; Control Action in Beijing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 3 - Corrections and Image Enhancements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 8 - Presentation of Sentinel-1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">4.1</span> Summary</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background"><span class="header-section-number">4.2</span> Background</a></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">4.3</span> Applications</a></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">4.4</span> Reflection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - Air Pollution &amp; Control Action in Beijing</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">4.1</span> Summary</h2>
<p>My city of choice is Beijing, the capital of China. Beijing is one of the most polluted cities in the world (Maji &amp; Lam, 2020). And its air quality improvements are a model for other cities.</p>
<p>2019, a new report by the United Nations Environment Programme (UN Environment) and the Beijing Municipal Ecology and Environment Bureau (BEE) outlines how Beijing‚Äôs air quality management programme has evolved over the past quarter century, called ‚ÄúA Review of 20 Years‚Äô of Air Pollution Control in Beijing‚Äù.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/AirPollution-Beijing.jpg" class="img-fluid figure-img" style="width:30.0%"></p>
<figcaption class="figure-caption">Source: <a href="https://www..org/resources/report/review-20-years-air-pollution-control-beijing">UNEP</a></figcaption>
</figure>
</div>
<p>In 1998 Beijing declared war on air pollution, the challenge was to find ways to improve air quality in one of the largest and fastest growing cities in the developing world. 20 years on and it appears that Beijing is winning the battle. Air quality has improved substantially, and the lessons learned provide a roadmap for other cities tackling air pollution.</p>
<p>‚ÄúThis improvement in air quality didn‚Äôt happen by accident. It was the result of an enormous investment of time, resources and political will,‚Äù said Joyce Msuya, Acting Executive Director of UN Environment. ‚ÄúUnderstanding Beijing‚Äôs air pollution story is crucial for any nation, district or municipality that wishes to follow a similar path.‚Äù</p>
</section>
<section id="background" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="background"><span class="header-section-number">4.2</span> Background</h2>
<p>With rapid urbanization and industrialization over the past thirty years, China has become one of the few countries in the world with the most severe air pollution. According to 2015 Global Burden of Disease study, PM2.5 was globally ranked as the fifth mortality risk factor, responsible for about 4.2 million deaths and 103.1 million years of life lost or lived with disability (Duke University, 2020). The impact of air pollution on atmospheric visibility, human health, and global climate change has garnered widespread public concern.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/BEIJing.jpg" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption class="figure-caption">Source: <a href="https://doi.org/10.1016/j.jclepro.2015.04.092">Zhang et al., 2016</a></figcaption>
</figure>
</div>
<p>In response to these challenges, the Beijing Municipal Government (BMG) has implemented a series of control policies, laws, and regulations since 1998, with a focus on controlling SO2 and Total Suspended Particulates (TSP). However, severe haze weather still occurs, especially during the heating season (autumn and winter) (Li et al., 2020). Particularly in January 2013, severe haze enveloped Beijing and the North China region, affecting over 800 million people (Liu et al., 2020).</p>
<p>Since then, starting in 2013, China has initiated unprecedented air quality improvement actions nationwide, especially targeting the management of fine particulate matter (PM2.5) pollution. The State Council of China issued the ‚ÄúAir Pollution Prevention and Control Action Plan‚Äù (APPCAP) on September 10, 2013, marking the first time China adopted a targeted national strategy aimed at improving air quality and set clear quantitative goals, such as requiring Beijing to control PM2.5 concentration to below 60Œºg/m¬≥ by 2017. To achieve this goal, the Beijing Municipal Government followed up with the ‚ÄúBeijing 2013-2017 Clean Air Action Plan‚Äù (Clean Air Action), implementing a series of stringent control measures.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/bike.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">A bike user braving polluted air in Beijing. Source: <a href="https://sustainablemobility.iclei.org/air-pollution-beijing/">Sustainablemobility</a></figcaption>
</figure>
</div>
<p>However, the winter of 2016 still saw frequent heavy pollution days. To meet the five-year target, the ‚Äú2017-2018 Autumn and Winter Comprehensive Air Pollution Control Action Plan for the Beijing-Tianjin-Hebei Region‚Äù (hereinafter referred to as the ‚ÄúComprehensive Action‚Äù) was subsequently implemented in the autumn of 2017. Finally, by the end of 2017, Beijing‚Äôs annual average PM2.5 concentration successfully dropped to 58Œºg/m¬≥, achieving the five-year goal of the Clean Air Action.</p>
<p>The journey towards cleaner air continued with the introduction of the three-year Blue Sky Defense Plan spanning from 2018 to 2020. This subsequent phase of environmental policy and action further accelerated improvements in air quality across Beijing, with PM2.5 annual average concentrations witnessing a steady decline to 42Œºg/m¬≥ by 2019. Such progress is indicative of Beijing‚Äôs ongoing commitment to enhancing its air quality, marking significant strides in the city‚Äôs environmental health landscape (Li et al., 2020).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/Birds nest.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Beijing‚Äôs Bird‚Äôs Nest in the haze and after the success of air control. Source: <a href="https://www.ccacoalition.org/news/beijings-air-quality-improvements-are-model-other-cities">CCAC</a></figcaption>
</figure>
</div>
<p>Beijing‚Äôs air quality management efforts are closely aligned with the United Nations Sustainable Development Goals (SDGs), specifically Goal 11 (to make cities and human settlements inclusive, safe, resilient, and sustainable) and Goal 13 (to take urgent action to combat climate change and its impacts). By improving air quality, Beijing not only enhances the health and quality of life of its residents but also contributes to the global fight against climate change.</p>
</section>
<section id="applications" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="applications"><span class="header-section-number">4.3</span> Applications</h2>
<p>To address the issue of air pollution in Beijing, especially PM2.5 pollution, a comprehensive approach involving remote sensing datasets and models has been utilized to monitor and analyze air quality with remarkable spatial and temporal accuracy. This approach is designed to offer actionable insights for the effective implementation of policies and the management of environmental health.</p>
<p>The application of satellite remote sensing technology plays a pivotal role in this strategy. It allows for the monitoring of atmospheric pollutants, such as PM2.5 and NO2, providing a detailed assessment of air quality trends over time. Through this technology, data is collected that can pinpoint the concentration levels of these pollutants, offering a dynamic view of how air quality fluctuates and identifying potential sources of pollution.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/pnas.1919641117fig03.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Annual mean spatial distribution of PM2.5 concentrations in China from 2000 to 2016 at 1-km spatial resolution. Source: <a href="https://doi.org/10.1073/pnas.1919641117">Liang et al., 2020</a></figcaption>
</figure>
</div>
<p>In this regard, Guo et al.utilized MODIS satellite data for remote sensing monitoring of PM2.5 pollution in the Beijing area, capable of estimating ground-level PM2.5 concentrations. This method, by correlating MODIS‚Äôs Aerosol Optical Depth (AOD) measurements with ground-based PM2.5 observational data, enhanced the accuracy of PM2.5 estimates, making a significant contribution to understanding and managing Beijing‚Äôs air pollution issue. The research demonstrated the potential of satellite remote sensing technology in supplementing ground monitoring data and providing information on the spatial distribution and temporal variation of pollutants (2014).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/tres_a_958245_f0001_c.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">Seasonal distributions of annual mean Aqua AOD550 over North and East China during March 2012 to February 2013. Areas with higher AOD are shown in red or orange, indicating a higher concentration of atmospheric particulates in those regions. The wind directions and velocity are shown as orange arrows. Source: <a href="https://doi.org/10.1080/01431161.2014.958245">Guo et al., 2014</a></figcaption>
</figure>
</div>
<p>Also, Yang et al.&nbsp;explored the spatiotemporal distributions of PM2.5 concentrations across the same region from 2013 to 2020. This study employed a two-stage statistical regression model (Linear Mixed Effects + Geographically Weighted Regression), considering various predictors including Aerosol Optical Depth (AOD) data, meteorological conditions, and land use information. The aim was to estimate daily PM2.5 distribution at a 1-km spatial resolution, analyzing long-term characteristics and trends of particulate pollution. This high-resolution data is crucial for identifying small-scale pollution hotspots and understanding the efficacy of pollution control measures over time (2022).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week4-images/fenvs-10-842237-g005.jpg" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption">The distribution of the annual mean estimated PM2.5 concentrations and observed PM2.5 concentrations in the Beijing‚ÄìTianjin‚ÄìHebei region during 2013‚Äì2020 (A‚ÄìH). Source: <a href="https://doi.org/10.3389/fenvs.2022.842237">Yang et al., 2022</a></figcaption>
</figure>
</div>
<p>Another notable study conducted by Ma et al.&nbsp;utilized the Visible Infrared Imaging Radiometer Suite Day/Night Band (VIIRS/DNB) combined with a deep learning model to estimate nighttime PM2.5 concentrations in the Beijing‚ÄìTianjin‚ÄìHebei region from 2015 to 2021. This approach enabled the generation of high-resolution PM2.5 concentration maps, offering a detailed view of pollution distribution and trends over time, which could greatly aid in understanding and combating air pollution at a granular level (2023).</p>
<p>Furthermore, Beijing has put in place a high resolution air pollution monitoring system that has enabled better enforcement of the cities air quality regulations. This video showcases how the system works and the benefits.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/KoafN46G3OQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>These studies exemplify the application of remote sensing and machine learning techniques in enhancing our understanding of air pollution patterns. The ability to monitor PM2.5 with high spatial and temporal resolution is a valuable asset in the fight against air pollution, providing a data-driven basis for policy decisions and interventions aimed at improving air quality in Beijing and similar urban environments.</p>
</section>
<section id="reflection" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="reflection"><span class="header-section-number">4.4</span> Reflection</h2>
<p>In conclusion, Beijing‚Äôs journey to improve air quality has not only achieved substantial reductions in pollutants like PM2.5, sulfur dioxide, and nitrogen oxides but also set a model for other cities worldwide. The collaborative efforts, stringent policies, and significant investments in air quality management have showcased a commendable balance between environmental protection and economic growth.</p>
<p>However, strategies for combating air pollution in Beijing have been multifaceted, focusing on reducing coal consumption, expanding urban rail networks, and introducing high-density sensor-based PM2.5 monitoring networks. These actions, backed by both municipal and national support, have been crucial in reshaping Beijing‚Äôs transportation and reducing its environmental footprint. Measures include the establishment of Low Emission Zones (LEZs) and the modernization of the bus fleet. Beijing has become a global leader in electric mobility, boasting a vast number of electric buses, and has made considerable investments in air quality improvement measures.</p>
<p>These efforts reflect an enormous investment of time, resources, and political will, aimed at transforming Beijing into a cleaner, more sustainable city. The progress made by Beijing offers valuable lessons and a roadmap for other cities facing similar challenges with air pollution, demonstrating the potential benefits of comprehensive planning, public engagement, and the adoption of new technologies for environmental improvement.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 - Corrections and Image Enhancements</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week5.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 3 - Corrections and Image Enhancements</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>