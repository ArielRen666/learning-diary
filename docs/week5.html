<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Arielâ€™s RS learning diary - 5&nbsp; Week 5 - Introduction to GEE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./week6.html" rel="next">
<link href="./week4.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./week5.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5 - Introduction to GEE</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Arielâ€™s RS learning diary</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><strong>Personal IntroductionðŸ˜Š</strong></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Week 1 - Introduction to Remote Sensing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Week 2 - Presentation of Sentinel-1</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Week 3 - Corrections and Image Enhancements</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - Air Pollution &amp; Control Action in Beijing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week5.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5 - Introduction to GEE</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 6 - Classification I</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./week7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Week 7 - Classification II</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#summary" id="toc-summary" class="nav-link active" data-scroll-target="#summary"><span class="header-section-number">5.1</span> Summary</a>
  <ul class="collapse">
  <li><a href="#what-can-google-earth-engine-do" id="toc-what-can-google-earth-engine-do" class="nav-link" data-scroll-target="#what-can-google-earth-engine-do"><span class="header-section-number">5.1.1</span> What Can Google Earth Engine Do?</a></li>
  <li><a href="#geospatial-processing-functions" id="toc-geospatial-processing-functions" class="nav-link" data-scroll-target="#geospatial-processing-functions"><span class="header-section-number">5.1.2</span> Geospatial Processing Functions</a></li>
  <li><a href="#how-to-get-started" id="toc-how-to-get-started" class="nav-link" data-scroll-target="#how-to-get-started"><span class="header-section-number">5.1.3</span> How to get started?</a></li>
  </ul></li>
  <li><a href="#applications" id="toc-applications" class="nav-link" data-scroll-target="#applications"><span class="header-section-number">5.2</span> Applications</a>
  <ul class="collapse">
  <li><a href="#gee-web-application-examples" id="toc-gee-web-application-examples" class="nav-link" data-scroll-target="#gee-web-application-examples"><span class="header-section-number">5.2.1</span> GEE Web Application Examples</a></li>
  <li><a href="#monitor-global-forest-changes" id="toc-monitor-global-forest-changes" class="nav-link" data-scroll-target="#monitor-global-forest-changes"><span class="header-section-number">5.2.2</span> Monitor Global Forest Changes</a></li>
  <li><a href="#monitor-natural-disaster" id="toc-monitor-natural-disaster" class="nav-link" data-scroll-target="#monitor-natural-disaster"><span class="header-section-number">5.2.3</span> Monitor Natural Disaster</a></li>
  <li><a href="#building-footprints" id="toc-building-footprints" class="nav-link" data-scroll-target="#building-footprints"><span class="header-section-number">5.2.4</span> Building Footprints</a></li>
  </ul></li>
  <li><a href="#reflection" id="toc-reflection" class="nav-link" data-scroll-target="#reflection"><span class="header-section-number">5.3</span> Reflection</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Week 5 - Introduction to GEE</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="summary" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="summary"><span class="header-section-number">5.1</span> Summary</h2>
<p>This week I stepped into a whole new world, GEE (<a href="https://earthengine.google.com/">Google Earth Engine</a>), which is a cloud-based platform that delivers a multi-petabyte catalog of satellite imagery for planetary-scale analysis.</p>
<p><strong>Itâ€™s an incredible resource for anyone who wants to explore the world through satellite imagery.</strong></p>
<p>We can not only gain access to remote sensing data from satellites, airborne, digital elevation models, but also we can turn this geospatial data into actionable insights through the platformâ€™s fast computations and 1000+ types of operators for analysis.</p>
<p>And the most important is that <strong>itâ€™s completely free</strong>!!!</p>
<p>From land use to weather data, itâ€™s through its vast (and growing) catalog of remote sensing data that we can see the world through a different lens. We can have access to many key datasets on this platform, such as Landsat (30m), Sentinel-2 (10-30m), MODIS (250m daily), Sentinel-1 (Radar), Land cover, Weather and Climate (NOAA) and so on.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week5-images/aral-sea_Hero.gif" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Surface water change visualization enabled by Google Earth Engine (Aral Sea from 1984-2020). Source: <a href="https://blog.google/products/earth/earth-engine-preview-google-cloud/">GOOGLE EARTH</a></figcaption>
</figure>
</div>
<p><strong>Letâ€™s step into the world of GEE and see how amazing it is!</strong></p>
<section id="what-can-google-earth-engine-do" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="what-can-google-earth-engine-do"><span class="header-section-number">5.1.1</span> What Can Google Earth Engine Do?</h3>
<p>GEE tackles the challenge of open analysis in remote sensing with a focus on getting results. Itâ€™s able to avoid any bottlenecks because itâ€™s able to adjust the size of its clusters based on how much demand there is for a data product.</p>
<table class="table">
<colgroup>
<col style="width: 29%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Functionality</th>
<th style="text-align: center;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Downloading an Image</td>
<td style="text-align: center;">pick an extent, projection, data type, band, date, and resolution</td>
</tr>
<tr class="even">
<td style="text-align: center;">Performing Library Functions</td>
<td style="text-align: center;">chain algorithms together for further analysis such as a band combination function</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Filtering a Collection</td>
<td style="text-align: center;">use the metadata to filter everything from the amount of cloud cover to the type of sensor</td>
</tr>
<tr class="even">
<td style="text-align: center;">Mapping an Algorithm to an Image Collection</td>
<td style="text-align: center;">apply it to a full collection like the entire United States with a batch computation instead of applying an algorithm to a single image</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Computing Aggregate Statistics</td>
<td style="text-align: center;">calculate the amount of area within an extent to check if it meets certain criteria</td>
</tr>
<tr class="even">
<td style="text-align: center;">Building Tabular Reports</td>
<td style="text-align: center;">create tabular reports to show specific information in a table format such as summarizing a detailed list of data, highlighting specific metrics, or showing comparisons between different sets of data</td>
</tr>
</tbody>
</table>
</section>
<section id="geospatial-processing-functions" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="geospatial-processing-functions"><span class="header-section-number">5.1.2</span> Geospatial Processing Functions</h3>
<p>GEE contains more than 1000 data types and operators to help lay a solid foundation for any type of remote sensing analysis.</p>
<p><img src="week5-images/Geospatial Processing Functions.png" class="img-fluid" style="width:70.0%"></p>
<p>In addition to these analysis tools, there are other specialty types of algorithms. For instance, cloud and shadow filtering algorithms help remove artifacts so we can focus your analysis on the Earthâ€™s surface.</p>
<p>But one of the most exciting areas of development in GEE is a shift to machine learning algorithms and deep neural networks. For example, (1) <strong>SVM</strong> (2) <strong>Random forests</strong> (3) <strong>K-Means</strong> (4) <strong>CART</strong></p>
</section>
<section id="how-to-get-started" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="how-to-get-started"><span class="header-section-number">5.1.3</span> How to get started?</h3>
<p>Isnâ€™t it amazing and powerful! I canâ€™t wait to operate it after hearing all this. If you want to learn how to do it, but are a complete beginner like me, I found the video below very helpful.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/oAElakLgCdA" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="applications" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="applications"><span class="header-section-number">5.2</span> Applications</h2>
<section id="gee-web-application-examples" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="gee-web-application-examples"><span class="header-section-number">5.2.1</span> GEE Web Application Examples</h3>
<p>On <a href="https://www.earthengine.app/">GEEâ€™s homepage</a> we can see that there are six curated applications, from time-lapse imagery to global forest change web maps. Each one demonstrates its powerful computing and how it can lead to making informed decisions for the environment.</p>
<ul>
<li><p><strong>Ocean Timelapse</strong>: one of the most powerful features of GEE is its vast amount of temporal data. With over 35+ years of imagery, itâ€™s like weâ€™re traveling back in time on an interactive map of the ocean.</p></li>
<li><p><strong>Linked Maps</strong>: shows separate viewports with different band combinations. While the natural color is similar to what the human eye sees, the color-infrared, Land/Water, and Vegetation viewport highlights other land use features.</p></li>
<li><p><strong>Split Panel</strong>: contains a slider with two separate images side-by-side. We can compare two images from different dates beside each other to easily check for the differences between them.</p></li>
<li><p><strong>Collection Mosaic</strong>: allows us to select from a group of Landsat-8 images, and based on it, the app will generate a mosaic using the median values.</p></li>
<li><p><strong>Global Population Explorer</strong>: after selecting a country, it dynamically creates a graph or table with the population density of that country.</p></li>
<li><p><strong>Global Forest Change</strong>: shows the results of global forest change using Landsat imagery between 2000 and 2016. We can interactively pan and zoom around in app and can symbolize deforestation based on the year of the loss or by the percent of tree cover.</p></li>
</ul>
<p><img src="week5-images/GEE123.png" class="img-fluid" style="width:43.0%"> <img src="week5-images/GEE456.png" class="img-fluid" style="width:55.0%"></p>
<p>Source:<a href="https://www.earthengine.app/">Google Earth Engine</a></p>
</section>
<section id="monitor-global-forest-changes" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="monitor-global-forest-changes"><span class="header-section-number">5.2.2</span> Monitor Global Forest Changes</h3>
<p>The most impressive application of GEE to me is illegal deforestation in Brazil. The teacher mentioned this very interesting case in the first week class, which aroused my great interest in GEE at that time.</p>
<p>Forests are critical ecosystems for fighting climate change, supporting livelihoods and protecting biodiversity.</p>
<p>Due to its vast forest resources, Brazil has always been targeted by international and domestic loggers, leading to massive human-induced destruction of the Amazon rainforest. In the past, illegal loggers took advantage of the limitations of technology and monitoring to avoid detection and prosecution. They carefully planned to cut down areas smaller than one square kilometer to escape monitoring at the kilometer resolution.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week5-images/BA_f2.jpeg" class="img-fluid figure-img" style="width:85.0%"></p>
<figcaption class="figure-caption">Spatial mapping of forest degradation in Brazilian Amazon forest ecosystems. Source: <a href="https://doi.org/10.1126/SCIENCE.ABB3021">Matricardi et al., 2020</a></figcaption>
</figure>
</div>
<p>However, the emergence of GEE changed all. To create the global forest map, GEE used a network of cloud-based servers to process 650,000 images across 10,000 computers working in parallel. It would have taken a solo computer 15 years to do the job.</p>
<p>GEEâ€™s 30-meter high resolution ensures that even the smallest environmental changes are detectable, greatly increasing the ability to detect illegal logging activities. As a result, about 100 lawsuits due to illegal logging were filed in just one year, compared to almost none in the previous 20 years.</p>
<p>Now, with the application below, we can easily access the global forest map, monitor forest changes in real time, and effectively expose and combat illegal logging activities.</p>
<div class="cell">
<div class="cell-output-display">
<iframe style="height:550px; width:100%" src="https://gfw.global/4a74NHM"></iframe>
</div>
</div>
</section>
<section id="monitor-natural-disaster" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="monitor-natural-disaster"><span class="header-section-number">5.2.3</span> Monitor Natural Disaster</h3>
<p><a href="https://www.un-spider.org/advisory-support/recommended-practices">The UNI-Spider Knowledge Portal platform</a> has been using the GEE as a tool to try to analyse and mitigate natural disasters. They use Sentinel-1 SAR data from Google Earth Engine for flood mapping and damage assessment, which is used to provide a comprehensive overview of flooding from small communities to countries (<a href="https://www.un-spider.org/advisory-support/recommended-practices/recommended-practice-google-earth-engine-flood-mapping">UNOOSA/UN-SPIDER, 2020</a>). In addition to the outline of flood areas, this code produces information about farmland affected to better plan for food security concerns after a disaster and the number of families that have been or could be affected by natural disasters.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="week5-images/Flood mapping.png" class="img-fluid figure-img" style="width:45.0%"></p>
<figcaption class="figure-caption">Flood mapping. Source: <a href="https://www.chiefscientist.qld.gov.au/publications/understanding-floods/chances-of-a-flood">Chiefscient</a></figcaption>
</figure>
</div>
</section>
<section id="building-footprints" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="building-footprints"><span class="header-section-number">5.2.4</span> Building Footprints</h3>
<p>I have to mention this because it is closely related to the topic of my dissertation. A building footprint dataset contains the two dimensional outlines of buildings in a given area. Currently, GEE hosts one building footprint dataset which covers all of Africa. In 2022, Microsoft released a free <a href="https://www.microsoft.com/en-us/maps/bing-maps/building-footprints/">global building footprint dataset</a>, though to use it in Earth Engine we have to download it from their <a href="https://github.com/Microsoft/USBuildingFootprints">GitHub page</a> and upload it manually to GEE. The same goes for OpenStreetMap (OSM), a public database of building footprints, roads, and other features that also contains useful annotations for many buildings indicating their use. The following great video teaches us how to map anything with freely available location data (OSM data).</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/bJkV3l5Haq0" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="reflection" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="reflection"><span class="header-section-number">5.3</span> Reflection</h2>
<p>This week, the introduction to Google Earth Engine (GEE) was a revelation, showcasing the staggering advancement in technology and data analytics is changing our lives and the world, also providing innovative means to solve some long-standing issues.</p>
<p>Initially, I, who first came into the coding world last semester and only learned R and Python, was apprehensive about using JavaScriptðŸ˜Ÿ. However, thanks to the plethora of tutorials available, now I found the required scripting are manageable. Its user-friendly nature and the direct access to analysis-ready data significantly enhanced my learning experience. Adapting to Earth Engineâ€™s quirksâ€”such as the inability to run code blocks independently, necessitating the execution of the entire script each timeâ€”was part of the learning curve.</p>
<p>After this week, I have found it really enjoyable to interact with GEE, its ability and speed to process large amounts of data (compared to what we have previously used with SNAP and R) is amazing and has revolutionised the way we approach and solve critical environmental problems. My current biggest hope is that such cool software will remain free, and I eagerly look forward to exploring the rest of it in depthðŸ¤©.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./week4.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Week 4 - Air Pollution &amp; Control Action in Beijing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./week6.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Week 6 - Classification I</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>